# Claude Gamify 产品需求文档 (PRD)

## 1. 产品概述

### 1.1 产品名称

Claude Gamify - Claude Code 游戏化系统

### 1.2 产品简介

Claude Gamify 是一个为 Claude Code 开发的游戏化增强工具，通过声音效果和主题化对话样式，将日常编程工作转化为沉浸式的冒险体验。产品采用 NPX CLI 工具形式，提供一键式安装和交互式管理界面。

### 1.3 目标用户

- Claude Code 的日常使用者
- 希望提升编程乐趣的开发者
- 对游戏化工作流感兴趣的程序员
- 追求个性化开发体验的用户

### 1.4 产品价值

- 提升编程工作的乐趣和参与感
- 为编程过程提供即时音效反馈
- 通过主题化对话增强沉浸式体验
- 零学习成本的一键式配置管理

## 2. 功能设计

### 2.1 声音效果系统

#### 2.1.1 事件触发音效

**功能描述**: 为 Claude Code 的核心操作事件提供音效反馈

**支持的事件类型**:

- **SessionStart** - Claude Code 会话开始时播放
- **UserPromptSubmit** - 用户发送消息时播放
- **PreToolUse** - Claude 开始使用工具前播放
- **PostToolUse** - Claude 完成工具使用后播放
- **Notification** - 系统通知时播放
- **Stop** - Claude 停止回复时播放
- **SubagentStop** - 子任务完成时播放

**功能特点**:

- 每个事件对应独立的音效文件
- 支持 WAV 格式音效文件
- 音效文件存储在主题目录下
- 异步播放，不阻塞 Claude Code 正常运行

#### 2.1.2 音效控制功能

**功能描述**: 提供细粒度的音效控制选项

**控制选项**:

- **全局音效开关** - 一键启用/禁用所有音效
- **音量调节** - 支持 0-100% 音量设置，内部存储为 0.0-1.0 浮点值
- **单事件控制** - 每个事件可独立启用/禁用
- **实时音效测试** - 支持单个音效和主题整体试听

**配置持久化**:

- 配置存储在 `~/.claude-gamify/config.json`
- 支持配置导入/导出功能
- 重启后自动恢复用户设置

### 2.2 主题系统

#### 2.2.1 Zelda 主题

**功能描述**: 塞尔达传说风格的完整游戏化体验

**音效特色**:

- 冒险风格的经典游戏音效
- 任务完成、宝箱开启等标志性声音
- 每个事件对应不同的音效文件

**对话风格**:

- 将用户称为"勇敢的开发者"或"英雄"
- 编程术语游戏化 (文件→神圣卷轴，函数→法术等)
- 冒险风格的进度更新和状态消息
- 使用游戏化语言描述技术操作

#### 2.2.2 System 主题

**功能描述**: 简洁现代的系统风格体验

**音效特色**:

- 清爽的系统提示音
- 现代化的操作反馈声音
- 专业简洁的音效设计

**对话风格**:

- 专业的技术对话方式
- 标准的编程术语使用
- 简洁明了的状态反馈

#### 2.2.3 主题管理功能

**功能描述**: 主题的安装、切换和管理

**核心功能**:

- **主题切换** - 一键切换不同主题体验
- **主题列表** - 显示所有可用主题
- **主题安装** - 从模板目录安装新主题到用户目录
- **主题移除** - 删除不需要的主题
- **输出样式同步** - 主题切换时自动更新 Claude 输出样式

### 2.3 交互式管理界面

#### 2.3.1 主菜单系统

**功能描述**: 提供直观的图形化管理入口

**菜单结构**:

- **欢迎界面** - 显示产品标识和版本信息
- **快速状态** - 当前主题、音效状态、音量等关键信息
- **主要功能入口** - 设置、主题管理、测试、系统信息等
- **退出选项** - 优雅退出和卸载选项

**界面特色**:

- 使用 ASCII 艺术字增强视觉效果
- 彩色终端输出提升用户体验
- 盒状边框设计保持界面整洁
- 支持 ESC 键快速退出所有菜单

#### 2.3.2 设置管理界面

**功能描述**: 集中化的配置管理界面

**设置分类**:

- **主题设置** - 主题选择和切换
- **音效设置** - 音量调节和全局开关
- **事件控制** - 每个钩子事件的独立开关
- **系统设置** - 高级配置和诊断选项

**交互特点**:

- 交互式选择器和滑块控件
- 实时配置预览和应用
- 配置变更即时生效
- 支持配置重置到默认值

#### 2.3.3 测试中心界面

**功能描述**: 音效测试和预览功能

**测试功能**:

- **单音效测试** - 测试特定事件的音效
- **主题预览** - 按顺序播放主题中所有音效
- **交互式测试** - 选择式音效试听菜单
- **音量测试** - 结合音量设置的实时测试

**测试控制**:

- 强制播放模式 (忽略音效开关设置)
- 测试过程可随时中断
- 测试状态实时显示

### 2.4 系统集成功能

#### 2.4.1 Claude Code 钩子集成

**功能描述**: 与 Claude Code 的深度集成

**集成方式**:

- 自动配置 `~/.claude/settings.json` 中的钩子设置
- 部署轻量级钩子入口点 `~/.claude-gamify/index.js`
- 钩子调用零依赖音效播放器 `play_sound.js`

**安全特性**:

- 非侵入式集成，保留用户现有钩子配置
- 智能合并钩子设置，避免覆盖其他工具
- 卸载时完整清理，不留残留配置

#### 2.4.2 输出样式管理

**功能描述**: 管理 Claude Code 的输出样式设置

**样式功能**:

- 自动安装主题对应的输出样式到 Claude 配置目录
- 主题切换时同步更新 Claude 的当前输出样式
- 支持样式的安装、激活、清理等操作
- 卸载时智能重置输出样式设置

### 2.5 命令行工具功能

#### 2.5.1 快捷命令

**功能描述**: 为不同使用场景提供快捷命令

**可用命令**:

- `npx claude-gamify` - 启动交互式主界面
- `npx claude-gamify init` - 重新初始化系统
- `npx claude-gamify status` - 显示快速状态信息
- `npx claude-gamify uninstall` - 完全卸载系统
- `npx claude-gamify check-updates` - 检查可用更新

**命令特点**:

- 命令执行结果带有彩色输出
- 错误情况下提供清晰的诊断信息
- 支持静默模式和详细输出模式

#### 2.5.2 一键初始化

**功能描述**: 全自动的系统安装和配置

**初始化流程**:

1. **环境检测** - 检查 Claude Code 安装和兼容性
2. **目录创建** - 创建 `~/.claude-gamify` 和相关目录
3. **文件部署** - 从模板复制核心文件到用户目录
4. **钩子配置** - 配置 Claude Code 钩子集成
5. **样式安装** - 安装默认主题的输出样式
6. **配置初始化** - 创建默认配置文件

**初始化特色**:

- 进度显示和状态反馈
- 错误自动诊断和修复建议
- 幂等性设计，支持重复执行
- 完成后自动进入主界面

### 2.6 系统维护功能

#### 2.6.1 版本管理

**功能描述**: 自动版本检查和升级管理

**版本功能**:

- 启动时静默检查新版本
- 发现新版本时在欢迎界面显示升级提示
- 支持本地系统的静默升级
- 显示更新日志和版本改进信息

#### 2.6.2 卸载功能

**功能描述**: 完整的系统清理和卸载

**卸载范围**:

- 移除所有 Claude Code 钩子配置
- 清理安装的输出样式
- 删除 `~/.claude-gamify` 目录及所有文件
- 重置相关的 Claude 配置设置

**卸载特色**:

- 交互式确认，避免意外删除
- 支持 `-y` 参数跳过确认
- 详细的清理报告和结果反馈
- 失败情况下的部分清理状态报告

#### 2.6.3 系统信息

**功能描述**: 系统状态监控和诊断信息

**信息内容**:

- 当前系统平台和 Node.js 版本
- Claude Code 配置路径和状态
- 当前主题和配置信息
- 音频系统兼容性检查结果
- 文件权限和目录状态检查

**诊断价值**:

- 故障排除时的关键信息
- 兼容性问题的快速诊断
- 配置问题的定位和分析

## 3. 配置规格

### 3.1 配置文件结构

```json
{
  "theme": "zelda",
  "sound_enabled": true,
  "sound_volume": 0.5,
  "sound_hooks": {
    "session_start": true,
    "user_prompt_submit": true,
    "pre_tool_use": true,
    "post_tool_use": true,
    "notification": true,
    "stop": true,
    "subagent_stop": true
  }
}
```

### 3.2 主题文件结构

```
themes/
├── zelda/
│   ├── SessionStart.wav
│   ├── UserPromptSubmit.wav
│   ├── PreToolUse.wav
│   ├── PostToolUse.wav
│   ├── Notification.wav
│   ├── Stop.wav
│   ├── SubagentStop.wav
│   └── output-style.md
└── system/
    ├── SessionStart.wav
    ├── UserPromptSubmit.wav
    ├── PreToolUse.wav
    ├── PostToolUse.wav
    ├── Notification.wav
    ├── Stop.wav
    ├── SubagentStop.wav
    └── output-style.md
```

## 4. 用户界面设计

### 4.1 视觉风格

- **终端友好** - 适配命令行环境的视觉设计
- **彩色输出** - 使用 chalk 提供丰富的颜色反馈
- **盒状设计** - 使用 boxen 创建清晰的信息区域
- **ASCII 艺术** - 使用 figlet 增强视觉冲击力

### 4.2 交互模式

- **菜单导航** - 基于 inquirer 的交互式菜单系统
- **键盘控制** - 支持方向键、回车、ESC 等标准控制
- **加载反馈** - 使用 ora 提供操作进度指示
- **错误处理** - 友好的错误消息和恢复建议

### 4.3 信息架构

- **层次化菜单** - 主菜单 → 功能子菜单 → 具体操作
- **状态驱动** - 根据系统状态动态调整可用选项
- **上下文感知** - 在相关位置显示适当的帮助信息

---

**文档版本**: v1.0  
**创建日期**: 2025-09-03

